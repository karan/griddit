/*
 griddit 2014-05-24 
*/
!function(a){null==a.isNumeric&&(a.isNumeric=function(a){return null!=a&&a.constructor===Number}),null==a.isFunction&&(a.isFunction=function(a){return null!=a&&a instanceof Function});var b=a(window),c=a(document),d={defaultConfig:{animate:!1,cache:!0,cellW:100,cellH:100,delay:0,engine:"giot",fixSize:null,gutterX:15,gutterY:15,selector:"> div",draggable:!1,rightToLeft:!1,bottomToTop:!1,onGapFound:function(){},onComplete:function(){},onResize:function(){},onBlockReady:function(){},onBlockFinish:function(){},onBlockActive:function(){}},plugin:{},totalGrid:1,transition:!1,loadBlock:function(b,c){var d=c.runtime,e=d.gutterX,f=d.gutterY,g=d.cellH,h=d.cellW,i=null,j=a(b),k=j.data("active"),l=j.attr("data-position"),m=parseInt(j.attr("data-fixSize")),n=d.lastId++ +"-"+d.totalGrid;if(!j.hasClass("fw-float")){j.attr({id:n,"data-delay":b.index}),c.animate&&this.transition&&this.setTransition(b,""),isNaN(m)&&(m=null),null==m&&(m=c.fixSize);var o=1==m?"ceil":"round";null==j.attr("data-height")&&j.attr("data-height",j.height()),null==j.attr("data-width")&&j.attr("data-width",j.width());var p=1*j.attr("data-height"),q=1*j.attr("data-width");c.cache||(b.style.width="",q=j.width(),b.style.height="",p=j.height());var r=q?Math[o]((q+e)/h):0,s=p?Math[o]((p+f)/g):0;if(m||"auto"!=c.cellH||(j.width(h*r-e),b.style.height="",p=j.height(),s=p?Math.round((p+f)/g):0),m||"auto"!=c.cellW||(j.height(g*s-f),b.style.width="",q=j.width(),r=q?Math.round((q+e)/h):0),null!=m&&(r>d.limitCol||s>d.limitRow))i=null;else if(s&&s<d.minHoB&&(d.minHoB=s),r&&r<d.minWoB&&(d.minWoB=r),s>d.maxHoB&&(d.maxHoB=s),r>d.maxWoB&&(d.maxWoB=r),0==q&&(r=0),0==p&&(s=0),i={id:n,width:r,height:s,fixSize:m},l){l=l.split("-"),i.y=1*l[0],i.x=1*l[1],i.width=null!=m?r:Math.min(r,d.limitCol-i.x),i.height=null!=m?s:Math.min(s,d.limitRow-i.y);var t=i.y+"-"+i.x+"-"+i.width+"-"+i.height;k?(d.holes[t]={id:i.id,top:i.y,left:i.x,width:i.width,height:i.height},this.setBlock(i,c)):delete d.holes[t]}return null==j.attr("data-state")?j.attr("data-state","init"):j.attr("data-state","move"),c.onBlockReady.call(b,i,c),l&&k?null:i}},setBlock:function(a,b){var c=b.runtime,d=c.gutterX,e=c.gutterY,f=a.height,g=a.width,h=c.cellH,i=c.cellW,j=a.x,k=a.y;b.rightToLeft&&(j=c.limitCol-j-g),b.bottomToTop&&(k=c.limitRow-k-f);var l={fixSize:a.fixSize,top:k*h,left:j*i,width:i*g-d,height:h*f-e};return l.top=1*l.top.toFixed(2),l.left=1*l.left.toFixed(2),l.width=1*l.width.toFixed(2),l.height=1*l.height.toFixed(2),a.id&&(c.blocks[a.id]=l),l},showBlock:function(b,c){function d(){if(j&&h.attr("data-state","start"),c.animate&&i.transition&&i.setTransition(b,k),g)g.fixSize&&(g.height=1*h.attr("data-height"),g.width=1*h.attr("data-width")),h.css({opacity:1,width:g.width,height:g.height}),h[f]({top:g.top,left:g.left}),null!=h.attr("data-nested")&&i.nestedGrid(b,c);else{var a=parseInt(b.style.height)||0,d=parseInt(b.style.width)||0,l=parseInt(b.style.left)||0,m=parseInt(b.style.top)||0;h[f]({left:l+d/2,top:m+a/2,width:0,height:0,opacity:0})}e.length-=1,c.onBlockFinish.call(b,g,c),0==e.length&&c.onComplete.call(b,g,c)}var e=c.runtime,f=c.animate&&!this.transition?"animate":"css",g=e.blocks[b.id],h=a(b),i=this,j="move"!=h.attr("data-state"),k=j?"width 0.5s, height 0.5s":"top 0.5s, left 0.5s, width 0.5s, height 0.5s, opacity 0.5s";b.delay&&clearTimeout(b.delay),h.hasClass("fw-float")||(i.setTransition(b,""),b.style.position="absolute",c.onBlockActive.call(b,g,c),c.delay>0?b.delay=setTimeout(d,c.delay*h.attr("data-delay")):d())},nestedGrid:function(b,c){var d,e=a(b),f=c.runtime,g=e.attr("data-gutterX")||c.gutterX,h=e.attr("data-gutterY")||c.gutterY,i=e.attr("data-method")||"fitZone",j=e.attr("data-nested")||"> div",k=e.attr("data-cellH")||c.cellH,l=e.attr("data-cellW")||c.cellW,m=f.blocks[b.id];if(m)switch(d=new freewall(e),d.reset({cellH:k,cellW:l,gutterX:1*g,gutterY:1*h,selector:j}),i){case"fitHeight":d[i](m.height);break;case"fitWidth":d[i](m.width);break;case"fitZone":d[i](m.width,m.height)}},adjustBlock:function(b,c){var d=c.runtime,e=d.gutterX,f=d.gutterY,g=a("#"+b.id),h=d.cellH,i=d.cellW;"auto"==c.cellH&&(g.width(b.width*i-e),g[0].style.height="",b.height=Math.round((g.height()+f)/h))},adjustUnit:function(b,c,d){var e=d.gutterX,f=d.gutterY,g=d.runtime,h=d.cellW,i=d.cellH;if(a.isFunction(h)&&(h=h(b)),h=1*h,!a.isNumeric(h)&&(h=1),a.isFunction(i)&&(i=i(c)),i=1*i,!a.isNumeric(i)&&(i=1),a.isNumeric(b)){1>h&&(h*=b);var j=Math.max(1,Math.floor(b/h));a.isNumeric(e)||(e=(b-j*h)/Math.max(1,j-1),e=Math.max(0,e)),j=Math.floor((b+e)/h),g.cellW=(b+e)/Math.max(j,1),g.cellS=g.cellW/h,g.gutterX=e,g.limitCol=j}if(a.isNumeric(c)){1>i&&(i*=c);var k=Math.max(1,Math.floor(c/i));a.isNumeric(f)||(f=(c-k*i)/Math.max(1,k-1),f=Math.max(0,f)),k=Math.floor((c+f)/i),g.cellH=(c+f)/Math.max(k,1),g.cellS=g.cellH/i,g.gutterY=f,g.limitRow=k}a.isNumeric(b)||(1>h&&(h=g.cellH),g.cellW=1!=h?h*g.cellS:1,g.gutterX=e,g.limitCol=666666),a.isNumeric(c)||(1>i&&(i=g.cellW),g.cellH=1!=i?i*g.cellS:1,g.gutterY=f,g.limitRow=666666)},resetGrid:function(a){a.blocks={},a.length=0,a.cellH=0,a.cellW=0,a.lastId=1,a.matrix={},a.totalCol=0,a.totalRow=0},setDraggable:function(b,d){var e=!1,f={startX:0,startY:0,top:0,left:0,handle:null,onDrop:function(){},onDrag:function(){},onStart:function(){}};a(b).each(function(){function b(a){return a.stopPropagation(),a=a.originalEvent,a.touches&&(e=!0,a=a.changedTouches[0]),2!=a.button&&3!=a.which&&(i.onStart.call(k,a),i.startX=a.clientX,i.startY=a.clientY,i.top=parseInt(l.css("top"))||0,i.left=parseInt(l.css("left"))||0,c.bind("mouseup touchend",h),c.bind("mousemove touchmove",g)),!1}function g(a){a=a.originalEvent,e&&(a=a.changedTouches[0]),l.css({top:i.top-(i.startY-a.clientY),left:i.left-(i.startX-a.clientX)}),i.onDrag.call(k,a)}function h(a){a=a.originalEvent,e&&(a=a.changedTouches[0]),i.onDrop.call(k,a),c.unbind("mouseup touchend",h),c.unbind("mousemove touchmove",g)}var i=a.extend({},f,d),j=i.handle||this,k=this,l=a(k),m=a(j),n=l.css("position");"absolute"!=n&&l.css("position","relative"),l.find("iframe, form, input, textarea, .ignore-drag").each(function(){a(this).on("touchstart mousedown",function(a){a.stopPropagation()})}),c.unbind("mouseup touchend",h),c.unbind("mousemove touchmove",g),m.unbind("mousedown touchstart").bind("mousedown touchstart",b)})},setTransition:function(b,c){var d=b.style,e=a(b);!this.transition&&e.stop?e.stop():null!=d.webkitTransition?d.webkitTransition=c:null!=d.MozTransition?d.MozTransition=c:null!=d.msTransition?d.msTransition=c:null!=d.OTransition?d.OTransition=c:d.transition=c},getFreeArea:function(a,b,c){for(var d=Math.min(a+c.maxHoB,c.limitRow),e=Math.min(b+c.maxWoB,c.limitCol),f=e,g=d,h=c.matrix,i=a;g>i;++i)for(var j=b;e>j;++j)h[i+"-"+j]&&j>b&&f>j&&(f=j);for(var i=a;d>i;++i)for(var j=b;f>j;++j)h[i+"-"+j]&&i>a&&g>i&&(g=i);return{top:a,left:b,width:f-b,height:g-a}},setWallSize:function(a,b){var c=a.totalRow,d=a.totalCol,e=a.gutterY,f=a.gutterX,g=a.cellH,h=a.cellW,i=Math.max(0,h*d-f),j=Math.max(0,g*c-e);b.attr({"data-total-col":d,"data-total-row":c,"data-wall-width":Math.ceil(i),"data-wall-height":Math.ceil(j)}),a.limitCol<a.limitRow&&!b.attr("data-height")&&b.height(Math.ceil(j))}},e={giot:function(a,b){function c(a,b,c,d,e){for(var f=b;b+e>f;){for(var g=c;c+d>g;)o[f+"-"+g]=a,++g>j&&(j=g);++f>k&&(k=f)}}var e=b.runtime,f=e.limitRow,g=e.limitCol,h=0,i=0,j=e.totalCol,k=e.totalRow,l={},m=e.holes,n=null,o=e.matrix,p=Math.max(g,f),q=null,r=null,s=f>g?1:0,t=null,u=Math.min(g,f);for(var v in m)m.hasOwnProperty(v)&&c(m[v].id||!0,m[v].top,m[v].left,m[v].width,m[v].height);for(var w=0;p>w&&a.length;++w){s?i=w:h=w,t=null;for(var x=0;u>x&&a.length;++x)if(s?h=x:i=x,!e.matrix[i+"-"+h]){q=d.getFreeArea(i,h,e),n=null;for(var v=0;v<a.length;++v)if(!(a[v].height>q.height||a[v].width>q.width)){n=a.splice(v,1)[0];break}if(null==n&&null==b.fixSize){if(t&&!s&&e.minHoB>q.height){t.height+=q.height,c(t.id,t.y,t.x,t.width,t.height),d.setBlock(t,b);continue}if(t&&s&&e.minWoB>q.width){t.width+=q.width,c(t.id,t.y,t.x,t.width,t.height),d.setBlock(t,b);continue}for(var v=0;v<a.length;++v)if(null==a[v].fixSize){n=a.splice(v,1)[0],s?(n.width=q.width,"auto"==b.cellH&&d.adjustBlock(n,b),n.height=Math.min(n.height,q.height)):(n.height=q.height,n.width=Math.min(n.width,q.width));break}}if(null!=n)l[n.id]={id:n.id,x:h,y:i,width:n.width,height:n.height,fixSize:n.fixSize},t=l[n.id],c(t.id,t.y,t.x,t.width,t.height),d.setBlock(t,b);else{var r={x:h,y:i,fixSize:0};if(s){r.width=q.width,r.height=0;for(var y=h-1,z=i;o[z+"-"+y];)o[z+"-"+h]=!0,r.height+=1,z+=1}else{r.height=q.height,r.width=0;for(var z=i-1,y=h;o[z+"-"+y];)o[i+"-"+y]=!0,r.width+=1,y+=1}b.onGapFound(d.setBlock(r,b),b)}}}e.matrix=o,e.totalRow=k,e.totalCol=j}};window.freewall=function(c){function f(b){var c=(k.gutterX,k.gutterY,k.cellH),e=k.cellW,f=a(b),g=f.find(f.attr("data-handle"));d.setDraggable(b,{handle:g[0],onStart:function(){j.animate&&d.transition&&d.setTransition(this,""),f.css("z-index",9999).addClass("fw-float")},onDrag:function(){var a=f.position(),b=Math.round(a.top/c),d=Math.round(a.left/e),g=Math.round(f.width()/e),h=Math.round(f.height()/c);b=Math.min(Math.max(0,b),k.limitRow-h),d=Math.min(Math.max(0,d),k.limitCol-g),i.setHoles({top:b,left:d,width:g,height:h}),i.refresh()},onDrop:function(){var b=f.position(),d=Math.round(b.top/c),g=Math.round(b.left/e),h=Math.round(f.width()/e),j=Math.round(f.height()/c);d=Math.min(Math.max(0,d),k.limitRow-j),g=Math.min(Math.max(0,g),k.limitCol-h),f.removeClass("fw-float"),f.css({zIndex:"auto",top:d*c,left:g*e});var l,m,n,o;for(m=0;j>m;++m)for(l=0;h>l;++l)n=m+d+"-"+(l+g),o=k.matrix[n],o&&1!=o&&a("#"+o).removeAttr("data-position");k.holes={},f.attr({"data-width":f.width(),"data-height":f.height(),"data-position":d+"-"+g}),i.refresh()}})}var g=a(c);"static"==g.css("position")&&g.css("position","relative");var h=Number.MAX_VALUE,i=this;d.totalGrid+=1;var j=a.extend({},d.defaultConfig),k={blocks:{},events:{},matrix:{},holes:{},cellW:0,cellH:0,cellS:1,filter:"",lastId:0,length:0,maxWoB:0,maxHoB:0,minWoB:h,minHoB:h,running:0,gutterX:15,gutterY:15,totalCol:0,totalRow:0,limitCol:666666,limitRow:666666,currentMethod:null,currentArguments:[]};j.runtime=k,k.totalGrid=d.totalGrid;var l=document.body.style;d.transition||(null!=l.webkitTransition||null!=l.MozTransition||null!=l.msTransition||null!=l.OTransition||null!=l.transition)&&(d.transition=!0),a.extend(i,{addCustomEvent:function(a,b){var c=k.events;return a=a.toLowerCase(),!c[a]&&(c[a]=[]),b.eid=c[a].length,c[a].push(b),this},appendBlock:function(b){var c=a(b).appendTo(g),h=null,i=[];k.currentMethod&&(c.each(function(a,b){b.index=++a,(h=d.loadBlock(b,j))&&i.push(h)}),e[j.engine](i,j),d.setWallSize(k,g),k.length=c.length,c.each(function(a,b){d.showBlock(b,j),(j.draggable||b.getAttribute("data-draggable"))&&f(b)}))},appendHoles:function(a){var b,c=[].concat(a),d={};for(b=0;b<c.length;++b)d=c[b],k.holes[d.top+"-"+d.left+"-"+d.width+"-"+d.height]=d;return this},container:g,destroy:function(){var b=g.find(j.selector).removeAttr("id");b.each(function(b,c){$item=a(c);var d=1*$item.attr("data-width")||"",e=1*$item.attr("data-height")||"";$item.width(d).height(e).css({position:"static"})})},fillHoles:function(a){if(0==arguments.length)k.holes={};else{var b,c=[].concat(a),d={};for(b=0;b<c.length;++b)d=c[b],delete k.holes[d.top+"-"+d.left+"-"+d.width+"-"+d.height]}return this},filter:function(a){return k.filter=a,k.currentMethod&&this.refresh(),this},fireEvent:function(a,b,c){var d=k.events;if(a=a.toLowerCase(),d[a]&&d[a].length)for(var e=0;e<d[a].length;++e)d[a][e].call(this,b,c);return this},fitHeight:function(c){var h=g.find(j.selector).removeAttr("id"),l=null,m=[];c=c?c:g.height()||b.height(),k.currentMethod=arguments.callee,k.currentArguments=arguments,d.resetGrid(k),d.adjustUnit("auto",c,j),k.filter?(h.data("active",0),h.filter(k.filter).data("active",1)):h.data("active",1),h.each(function(b,c){var e=a(c);c.index=++b,(l=d.loadBlock(c,j))&&e.data("active")&&m.push(l)}),i.fireEvent("onGridReady",g,j),e[j.engine](m,j),d.setWallSize(k,g),i.fireEvent("onGridArrange",g,j),k.length=h.length,h.each(function(a,b){d.showBlock(b,j),(j.draggable||b.getAttribute("data-draggable"))&&f(b)})},fitWidth:function(c){var h=g.find(j.selector).removeAttr("id"),l=null,m=[];c=c?c:g.width()||b.width(),k.currentMethod=arguments.callee,k.currentArguments=arguments,d.resetGrid(k),d.adjustUnit(c,"auto",j),k.filter?(h.data("active",0),h.filter(k.filter).data("active",1)):h.data("active",1),h.each(function(b,c){var e=a(c);c.index=++b,(l=d.loadBlock(c,j))&&e.data("active")&&m.push(l)}),i.fireEvent("onGridReady",g,j),e[j.engine](m,j),d.setWallSize(k,g),i.fireEvent("onGridArrange",g,j),k.length=h.length,h.each(function(a,b){d.showBlock(b,j),(j.draggable||b.getAttribute("data-draggable"))&&f(b)})},fitZone:function(c,h){var l=g.find(j.selector).removeAttr("id"),m=null,n=[];h=h?h:g.height()||b.height(),c=c?c:g.width()||b.width(),k.currentMethod=arguments.callee,k.currentArguments=arguments,d.resetGrid(k),d.adjustUnit(c,h,j),k.filter?(l.data("active",0),l.filter(k.filter).data("active",1)):l.data("active",1),l.each(function(b,c){var e=a(c);c.index=++b,(m=d.loadBlock(c,j))&&e.data("active")&&n.push(m)}),i.fireEvent("onGridReady",g,j),e[j.engine](n,j),d.setWallSize(k,g),i.fireEvent("onGridArrange",g,j),k.length=l.length,l.each(function(a,b){d.showBlock(b,j),(j.draggable||b.getAttribute("data-draggable"))&&f(b)})},fixPos:function(b){return a(b.block).attr({"data-position":b.top+"-"+b.left}),this},fixSize:function(b){return null!=b.height&&a(b.block).attr({"data-height":b.height}),null!=b.width&&a(b.block).attr({"data-width":b.width}),this},prepend:function(a){return g.prepend(a),k.currentMethod&&this.refresh(),this},refresh:function(){var a=arguments.length?arguments:k.currentArguments;return null==k.currentMethod&&(k.currentMethod=this.fitWidth),k.currentMethod.apply(this,Array.prototype.slice.call(a,0)),this},reset:function(b){return a.extend(j,b),this},setHoles:function(a){var b,c=[].concat(a),d={};for(k.holes={},b=0;b<c.length;++b)d=c[b],k.holes[d.top+"-"+d.left+"-"+d.width+"-"+d.height]=d;return this},unFilter:function(){return delete k.filter,this.refresh(),this}}),g.attr("data-min-width",80*Math.floor(b.width()/80));for(var m in d.plugin)d.plugin.hasOwnProperty(m)&&d.plugin[m].call(i,j,g);b.resize(function(){k.running||(k.running=1,setTimeout(function(){k.running=0,j.onResize.call(i,g)},122),g.attr("data-min-width",80*Math.floor(b.width()/80)))})},freewall.addConfig=function(b){a.extend(d.defaultConfig,b)},freewall.createEngine=function(b){a.extend(e,b)},freewall.createPlugin=function(b){a.extend(d.plugin,b)},freewall.getMethod=function(a){return d[a]}}(window.Zepto||window.jQuery);