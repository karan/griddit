/*
 griddit 2014-05-27 
*/
$(function(){function a(a,c){for(var d="",e=$(window).innerWidth()/3,f=0;f<a.length;f++)d+=b(a[f],e);c(d)}function b(a,b){var c=$("<div>",{"class":"brick"});c.width(b);var d=$("<img />");return d.attr("src",a.img_src),d.css({width:b+"px"}),c.append("<a href='"+a.permalink+"' target='_blank'>"+d[0].outerHTML+"</a>"),c[0].outerHTML}function c(a,b){ga("send","event","input","redditApiCall"),posts=[],$.ajax({type:"get",url:"http://api.reddit.com/r/"+a+"/hot.json?limit=20&after="+f,beforeSend:function(){$("#searchterm").addClass("loadinggif")},complete:function(){$("#searchterm").removeClass("loadinggif")},success:function(a){var c=a.data.children;c.forEach(function(a){if(!a.data.is_self&&/\.(gif|jpg|jpeg|tiff|png)$/i.test(a.data.url)){var b={title:a.data.title,img_src:"http://i.embed.ly/1/image/resize?url="+a.data.url+"&key=92b31102528511e1a2ec4040d3dc5c07&width="+$(window).innerWidth()/4,name:a.data.name,permalink:"http://reddit.com"+a.data.permalink};posts.push(b),f=a.data.name}}),g=!0,b(posts)}})}function d(a){$("#grid").append(a);var b=new freewall("#grid");b.reset({selector:".brick",animate:!0,cellW:160,cellH:"auto",onResize:function(){b.fitWidth()}}),b.container.find(".brick img").load(function(){b.fitWidth()}),$(window).trigger("resize")}function e(b){ga("send","event","input","newSearch-call"),window.location.hash=b,c(b,function(b){a(b,function(a){d(a)})})}var f="",g=!0,h="cats";$(window).scroll(function(){g&&$(window).scrollTop()>=$(document).height()-$(window).height()-50&&(ga("send","event","input","scroll"),g=!1,e(h))});var i=window.location.hash;e(i?i.substr(1):h),$("#searchterm").keypress(function(a){13==a.which&&(ga("send","event","input","search"),$("#grid").empty(),f="",a.preventDefault(),h=$("#searchterm").val(),e(h))}),$("#help").click(function(){return ga("send","event","input","modal"),$("#openModal").modal({fadeDuration:250}),!1})});